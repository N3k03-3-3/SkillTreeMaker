---

# 目指す開発フローを、仕様として確定させる

ねコさんのイメージはこうだった。

開発
→ Godotカスタムアドインでスキルツリー作成ツール導入
→ GUIで作成
→ ゲーム内に反映
→ 特定イベントで呼び出し
→ ゲーム内で確認

これを確実に成立させるには、実は「ツール」と「ゲーム」で役割を分けるのが一番大事。

ツールの責務は **編集・検証・書き出し（パック化）**。
ゲームの責務は **読み込み・描画・操作・取得判定（必要なら）**。

そして、両者を繋ぐのが **“SkillTree Pack”**（パック成果物）という共通形式。

---

# SkillTree Pack（後者）の中身：最小で強い構成

パックは「1つのフォルダ」になっていて、その中に JSON とテーマ素材が入る。

例：

```
SkillTreePacks/
  Constellation_A/
    pack.json
    runtime.json
    theme/
      background.png
      frame_9slice.png
      node_base.png
      node_locked.png
      node_unlocked.png
      node_glow.png
    icons/
      skill_001.png
      skill_002.png
    vfx/
      glow.png
      sparkle.png
```

ここでポイントは2つ。

パックは「ゲームプロジェクト内に置ける」こと。
そして、ゲーム側はパックの場所を指定すれば **全部読める**こと。

---

# JSONは2枚に分ける（事故を防ぐ）

後者をやるなら、JSONは必ず分離した方がいい。

## pack.json（編集・管理・素材参照のための情報）

ツールが管理する情報を全部持つ。
素材のパス、編集用のカメラ位置、作業中のメモ、未使用ノードなども含めてOK。

## runtime.json（ゲームが読む最低限）

ゲームはこれだけを読む。
ノード、接続、座標、文言キー、テーマ参照、payload（任意）だけ。

こうしておくと、ツールが育ってもゲーム側が壊れない。

---

# “テーマ”の設計：汎用化の要

ねコさんの要件は「背景、説明文、ウィンドウ枠、Nodeデザイン、エフェクト、色、サイズ…」が変えられること。

これを破綻させないコツは、テーマを **Style Preset** にすること。

たとえばツール内に

「背景プリセット」
「ウィンドウ枠プリセット」
「ノードプリセット（locked/unlockable/unlocked）」
「線プリセット」
「エフェクトプリセット」

を持たせて、ツリーはそれを参照するだけにする。

すると「別ゲームへ転用」がめちゃくちゃ簡単になる。
テーマフォルダを差し替えるだけで雰囲気が変わるから。

---

# Godotアドインとしての実装方針

完成形は **EditorPlugin（addons）**。

Godot上で、上部メニューに `SkillTree Maker` タブが増えるイメージ。
そこで作ったものを `res://SkillTreePacks/` に出力する。

重要なのは「プロジェクトを跨いでも動く」こと。
なので、アドイン自体は `addons/skill_tree_maker/` に閉じ込めて、出力だけゲーム側のフォルダへ書く。

これでツールは “移植可能”。

---

# ゲーム内反映の最短ルート

ゲーム側には「ランタイム表示用Scene」を1枚だけ作る。

`SkillTreeViewer.tscn`
中身は大雑把にいうと

背景
枠
ノード群
接続線
説明ウィンドウ（選択ノードの説明）

これを `SkillTreePackLoader` が runtime.json から生成する。

そして「イベントで呼び出し」は、

EventManager（ストーリー/イベント枠組み）
→ SkillTreeViewerを開く
→ パックIDを渡す

という流れにするのが自然。

（この設計は、今あるイベント設計思想とも相性がいい。星座イベントはノード取得トリガーになり得るしね。）

---

# 開発イメージを、具体の“作業手順書”に落とす

ここから先は、手順書の章立てにしておくと、そのままドキュメントになる。

## 1. アドイン導入

addons/skill_tree_maker をプロジェクトへ追加
Project Settingsで有効化
ツールタブが表示されることを確認

## 2. パック作成

New Pack → pack名 → 出力先（res://SkillTreePacks/PackName）
テーマテンプレを選択（Default/Space/Arcane等）

## 3. GUIデザイン

キャンバスでノード配置
接続（依存）作成
プロパティ編集（ノード見た目、説明文キー、コスト等）
背景・枠・エフェクトのプリセット調整

## 4. Validate

循環参照チェック
未接続ノードチェック
開始ノードの存在チェック
（ここは“転用可能”な検証だけに限定）

## 5. Export

pack.json と runtime.json を出力
素材をパック内へコピー（参照漏れを防ぐ）
バージョン番号も付ける（例：pack_version: 1）

## 6. ゲーム内でロード確認

SkillTreeViewerをイベントから開く
指定パックを読み込む
描画/操作/説明表示が一致することを確認

---
